(this["webpackJsonpreact-slide"]=this["webpackJsonpreact-slide"]||[]).push([[0],{13:function(e,t,r){},14:function(e,t,r){"use strict";r.r(t);var a=r(1),n=r(2),s=r(3),i=r(5),o=r(4),l=r(0),c=r.n(l),u=r(7),h=r.n(u);r(13);function d(e,t){if("undefined"===typeof e||"undefined"===typeof t)return null;var r=g(e[1]-t[1]),a=p(e[0]-t[0],e[1]);return Math.sqrt(r*r+a*a)}function g(e){return 110.574*Math.abs(e)}function p(e,t){var r=t*Math.PI/180;return 111.32*Math.abs(e)*Math.cos(r)}var v=function(e){return f[e]},f={CLEAR_STATE:!1,SET_GPS:!1,CELL_OVERAL:!1,DISABLE_MOVE_CHECK:!1,LOCAL_SERVER:!1};var m=function(e){var t=e.value,r=!1,a=e.isNearest,n=a?"square selected":"square",s=null;if(a){var i,o,l=.5*e.w,u=.5*e.h,h=p(e.geoUser[0]-e.geoCenter[0],e.geoUser[1]),f=g(e.geoUser[1]-e.geoCenter[1]),m=Math.sqrt(h*h+f*f),b=0,w=0;m>1e-4&&(b=h/m,w=f/m);var S,k=e.geoCenter[2];if(m<k)S=m/k*30,r=!0;else{var y=e.geoCenter[3];m=Math.min(m,y),S=(m-k)/(y-k)*(e.h/2-30)+30}i=l+S*b,o=u+S*w,s=c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"circle"}),c.a.createElement(E,{className:"user-circle",x:i,y:o,active:r,inCell:a}),c.a.createElement(E,{className:"center-circle",x:l,y:u,active:r,inCell:a}))}if(!t)return c.a.createElement("td",{className:"square empty",style:{width:e.w,height:e.h}},s);var z=t%e.rows,L=Math.floor(t/e.rows),N=d(e.geoCenter,e.geoUser),q=v("CELL_OVERLAY")?c.a.createElement("span",{style:{position:"absolute",color:"white",backgroundColor:"black"}}," ",e.geoCenter.toString()+" ==> "+N+", in="+a," "):null;return c.a.createElement("td",{className:n,onClick:function(){return e.handleClick()},style:{width:e.w,height:e.h}},q,s,c.a.createElement(C,{img:e.img,w:e.cols*e.w,h:e.rows*e.h,sx:z*e.w,sy:L*e.h,inCell:a}))};function E(e){if(!e.inCell)return c.a.createElement(c.a.Fragment,null);var t,r,a=e.className;return e.active&&(a+=" active"),c.a.createElement("div",{className:a,style:(t=e.x,r=e.y,{transform:"translate(".concat(t,"px, ").concat(r,"px)")})})}function C(e){return c.a.createElement("img",{src:e.img,alt:"stub",style:{marginTop:-e.sy+"px",width:e.w+"px",height:e.h+"px",marginLeft:-e.sx+"px"}})}v("LOCAL_SERVER"),v("CLEAR_STATE")&&localStorage.clear();var b=function(e){Object(i.a)(r,e);var t=Object(o.a)(r);function r(e){var a;Object(n.a)(this,r),a=t.call(this,e);var s,i=localStorage[a.props.puzzleName];return i?s=i.split(",").map((function(e){return Number(e)})):(s=[0,1,2,3,4,5,6,7,8],a.scramble(s),localStorage[a.props.puzzleName]=s),a.state={squares:s,width:window.innerWidth,height:window.innerHeight},setInterval((function(){a.setState({width:window.innerWidth,height:window.innerHeight})}),2e3),setInterval((function(){}),2e3),a}return Object(s.a)(r,[{key:"minIndex",value:function(e){for(var t=-1,r=999999,a=0;a<e.length;a++)e[a]<r&&(t=a,r=e[a]);return[t,r]}},{key:"findNearest",value:function(e,t){for(var r=-1,a=9999999999,n=0;n<t.length;n++){var s=this.geoDistance(e,t[n]);s<a&&(a=s,r=n)}return r}},{key:"neighborsOf",value:function(e){var t=[],r=this.props.serverData.gridsize[0],a=this.props.serverData.gridsize[1],n=Math.floor(e/r);return e+r<r*a&&t.push(e+r),e-r>=0&&t.push(e-r),Math.floor((e+1)/r)===n&&t.push(e+1),e>0&&Math.floor((e-1)/r)===n&&t.push(e-1),t}},{key:"scramble",value:function(e){for(var t=0;t<50;t++){console.log(e);var r=e.indexOf(0),a=this.neighborsOf(r),n=a[Math.floor(Math.random()*a.length)];e[r]=e[n],e[n]=0}}},{key:"handleClick",value:function(e){this.updateNearest();var t=this.state.squares.slice(),r=this.neighborsOf(e);if(v("DISABLE_MOVE_CHECK")||e===this.nearest)for(var a=0;a<r.length;a++)if(0===t[r[a]]){t[r[a]]=t[e],t[e]=0;break}localStorage[this.props.puzzleName]=t,this.setState({squares:t})}},{key:"renderSquare",value:function(e,t){var r=this,a=this.props.serverData.imgsize,n=this.props.serverData.gridsize,s=a[0]/a[1],i=.9*window.innerWidth/n[0],o=.9*window.innerHeight/n[1];return i/o>s?i=o*s:o=i/s,c.a.createElement(m,{img:"https://beethacker.github.io/slidepuzzle/img/"+this.props.serverData.img,value:this.state.squares[e],isNearest:e===this.nearest,geoUser:this.props.geoUser,geoCenter:this.props.serverData.cells[e],handleClick:function(){return r.handleClick(e)},w:i,h:o,rows:this.props.serverData.gridsize[0],cols:this.props.serverData.gridsize[1]})}},{key:"updateNearest",value:function(){var e=this;this.nearest=-1;var t=[];this.props.hasLocation&&(t=this.props.serverData.cells.map((function(t){return d(e.props.geoUser,t)})),this.nearest=this.minIndex(t)[0])}},{key:"render",value:function(){return this.updateNearest(),c.a.createElement("center",null,c.a.createElement("table",{className:"grid"},c.a.createElement("tr",{className:"board-row"},this.renderSquare(0),this.renderSquare(1),this.renderSquare(2)),c.a.createElement("tr",{className:"board-row"},this.renderSquare(3),this.renderSquare(4),this.renderSquare(5)),c.a.createElement("tr",{className:"board-row"},this.renderSquare(6),this.renderSquare(7),this.renderSquare(8))))}}]),r}(c.a.Component);function w(e){return c.a.createElement("fieldset",null,c.a.createElement("legend",null," Debug Coordinates "),c.a.createElement("input",{value:e.coords[0]+", "+e.coords[1],onChange:e.onChange,style:{width:"100%"}}))}var S=function(e){Object(i.a)(r,e);var t=Object(o.a)(r);function r(e){var s;Object(n.a)(this,r),s=t.call(this,e);var i=window.location.pathname.slice(1);if(i.startsWith("slidepuzzle")&&(i=i.slice(11)),i.length<=0&&"404_hack"in localStorage&&((i=localStorage["404_hack"]).startsWith("slidepuzzle")&&(i=i.slice(11)),console.log("Reading 404 hack property: "+i),localStorage.removeItem("404_hack")),s.state={hasLocation:!1,coords:[44,-63],serverData:null,puzzle:i},i.length>0){var o="https://beethacker.github.io/slidepuzzle/json/"+i+".json";fetch(o).then((function(e){return e.json()})).then((function(e){return s.setState({serverData:e})})).catch((function(e){return s.setState({fetchError:"Failed to fetch: "+o})}))}else s.setState({fetchError:"!Main Page!"});return s.updateGeoLocation(),setInterval((function(){s.updateGeoLocation()}),15e3),s.debugChangeCoord=s.debugChangeCoord.bind(Object(a.a)(s)),s}return Object(s.a)(r,[{key:"updateGeoLocation",value:function(){var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){e.setState({coords:[t.coords.latitude,t.coords.longitude],hasLocation:!0})})):this.setState({hasLocation:!1})}},{key:"debugChangeCoord",value:function(e){var t=e.target.value.split(",").map((function(e){return parseFloat(e)}));this.setState({coords:t})}},{key:"render",value:function(){return this.state.fetchError?c.a.createElement("div",null," ",this.state.fetchError," "):null===this.state.serverData?c.a.createElement("div",null," Loading..."):c.a.createElement("div",null,v("SET_GPS")?c.a.createElement(w,{coords:this.state.coords,onChange:this.debugChangeCoord}):null,c.a.createElement(b,{puzzleName:this.state.puzzle,serverData:this.state.serverData,geoUser:this.state.coords,hasLocation:this.state.hasLocation}))}}]),r}(c.a.Component);h.a.render(c.a.createElement(S,null),document.getElementById("root"))},8:function(e,t,r){e.exports=r(14)}},[[8,1,2]]]);
//# sourceMappingURL=main.7629c937.chunk.js.map